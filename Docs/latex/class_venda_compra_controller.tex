\doxysection{Referência à classe Venda\+Compra\+Controller}
\label{class_venda_compra_controller}\index{VendaCompraController@{VendaCompraController}}


Controlador para a gestão de vendas e compras.  


Diagrama de heranças da classe Venda\+Compra\+Controller\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=2.000000cm]{class_venda_compra_controller}
\end{center}
\end{figure}
\doxysubsubsection*{Membros públicos}
\begin{DoxyCompactItemize}
\item 
\textbf{ Venda\+Compra\+Controller} ()
\begin{DoxyCompactList}\small\item\em Construtor da classe {\ttfamily \doxyref{Venda\+Compra\+Controller}{p. }{class_venda_compra_controller}}. \end{DoxyCompactList}\item 
\textbf{ override} \textbf{ List}$<$ \textbf{ object} $>$ \textbf{ Get\+Items} ()
\begin{DoxyCompactList}\small\item\em Obtém os itens de vendas e compras para exibição. \end{DoxyCompactList}\item 
\textbf{ override} \textbf{ void} \textbf{ Remove\+Item} (\textbf{ object} \textbf{ item})
\begin{DoxyCompactList}\small\item\em Remove uma venda do sistema. \end{DoxyCompactList}\item 
\textbf{ int} \textbf{ Calcula\+Garantia} (\textbf{ Utilizador} cliente)
\begin{DoxyCompactList}\small\item\em Calcula a garantia da compra. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Membros públicos herdados de \textbf{ Base\+Controller$<$ Venda\+Compra $>$}}
\begin{DoxyCompactItemize}
\item 
\textbf{ Base\+Controller} (\textbf{ string} file\+Path)
\begin{DoxyCompactList}\small\item\em Construtor da classe \doxyref{Base\+Controller}{p. }{class_base_controller}. Inicializa o repositório com base no caminho de ficheiro fornecido. \end{DoxyCompactList}\item 
\textbf{ void} \textbf{ Add\+Item} (\textbf{ T} \textbf{ item})
\begin{DoxyCompactList}\small\item\em Adiciona um novo item ao repositório. \end{DoxyCompactList}\item 
\textbf{ object} \textbf{ Get\+By\+Id} (\textbf{ int}? \textbf{ id})
\begin{DoxyCompactList}\small\item\em Obtém um item pelo seu identificador. \end{DoxyCompactList}\item 
\textbf{ virtual} \textbf{ void} \textbf{ Update\+Item} (\textbf{ object} \textbf{ item})
\begin{DoxyCompactList}\small\item\em Atualiza um item específico. Este método pode ser re-\/implementado pelas classes derivadas para definir a lógica de atualização. \end{DoxyCompactList}\item 
\textbf{ List}$<$ \textbf{ object} $>$ \textbf{ Filtrar\+Itens} (\textbf{ List}$<$ \textbf{ object} $>$ items, \textbf{ string} \textbf{ filtro}, \textbf{ string} \textbf{ coluna})
\begin{DoxyCompactList}\small\item\em Filtra itens com base em uma propriedade e um filtro. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Membros públicos herdados de \textbf{ IEntity\+Controller}}
\begin{DoxyCompactItemize}
\item 
\textbf{ object} \textbf{ Get\+By\+Id} (\textbf{ int}? \textbf{ id})
\begin{DoxyCompactList}\small\item\em Obtém um item pelo seu identificador. \end{DoxyCompactList}\item 
\textbf{ void} \textbf{ Update\+Item} (\textbf{ object} \textbf{ item})
\begin{DoxyCompactList}\small\item\em Atualiza um item. \end{DoxyCompactList}\item 
\textbf{ List}$<$ \textbf{ object} $>$ \textbf{ Filtrar\+Itens} (\textbf{ List}$<$ \textbf{ object} $>$ items, \textbf{ string} \textbf{ filtro}, \textbf{ string}? \textbf{ coluna})
\end{DoxyCompactItemize}
\doxysubsubsection*{Outros membros herdados}
\doxysubsection*{Atributos Protegidos herdados de \textbf{ Base\+Controller$<$ Venda\+Compra $>$}}
\begin{DoxyCompactItemize}
\item 
\textbf{ readonly} \textbf{ Base\+Repo}$<$ \textbf{ T} $>$ \textbf{ \+\_\+repository}
\begin{DoxyCompactList}\small\item\em Referência ao repositório base utilizado para operações nos itens. \end{DoxyCompactList}\item 
\textbf{ List}$<$ \textbf{ T} $>$ \textbf{ \+\_\+items}
\begin{DoxyCompactList}\small\item\em Lista local de itens atualmente carregados. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Descrição detalhada}
Controlador para a gestão de vendas e compras. 

A classe {\ttfamily \doxyref{Venda\+Compra\+Controller}{p. }{class_venda_compra_controller}} é responsável pela gestão das vendas e compras. Ela lida com a exibição das informações de vendas, cálculo de garantias e a remoção de itens de vendas, além de atualizar o stock dos produtos vendidos.

\begin{DoxyAuthor}{Autor}
Miguel Areal 
\end{DoxyAuthor}
\begin{DoxyDate}{Data}
12/2024 
\end{DoxyDate}


Definido na linha \textbf{ 17} do ficheiro \textbf{ Venda\+Compra\+Controller.\+cs}.



\doxysubsection{Documentação dos Construtores \& Destrutor}
\label{class_venda_compra_controller_a93b083e50906dc91b931a6c8cd6ea4fe} 
\index{VendaCompraController@{VendaCompraController}!VendaCompraController@{VendaCompraController}}
\index{VendaCompraController@{VendaCompraController}!VendaCompraController@{VendaCompraController}}
\doxysubsubsection{VendaCompraController()}
{\footnotesize\ttfamily Venda\+Compra\+Controller.\+Venda\+Compra\+Controller (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Construtor da classe {\ttfamily \doxyref{Venda\+Compra\+Controller}{p. }{class_venda_compra_controller}}. 

Inicializa o controlador com o caminho do ficheiro de dados onde as vendas são armazenadas. 

Definido na linha \textbf{ 26} do ficheiro \textbf{ Venda\+Compra\+Controller.\+cs}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00026\ :\ base(\textcolor{stringliteral}{"{}Data/vendas.json"{}})\ \{\ \}}

\end{DoxyCode}


\doxysubsection{Documentação das funções}
\label{class_venda_compra_controller_aaa36d55d39764c42667a175744e89e76} 
\index{VendaCompraController@{VendaCompraController}!CalculaGarantia@{CalculaGarantia}}
\index{CalculaGarantia@{CalculaGarantia}!VendaCompraController@{VendaCompraController}}
\doxysubsubsection{CalculaGarantia()}
{\footnotesize\ttfamily \textbf{ int} Venda\+Compra\+Controller.\+Calcula\+Garantia (\begin{DoxyParamCaption}\item[{\textbf{ Utilizador}}]{cliente }\end{DoxyParamCaption})}



Calcula a garantia da compra. 

Este método calcula a garantia de uma compra com base no NIF do cliente. Se o NIF começar com 1, 2 ou 3, é um cliente particular; caso contrário, é uma empresa. O cálculo de garantia varia dependendo do tipo de cliente.


\begin{DoxyParams}{Parâmetros}
{\em cliente} & O objeto {\ttfamily \doxyref{Utilizador}{p. }{class_utilizador}} que representa o cliente a efetuar a compra. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Retorna}
O número de meses de garantia (36 meses para clientes particulares, 12 meses para empresas). 
\end{DoxyReturn}


Definido na linha \textbf{ 121} do ficheiro \textbf{ Venda\+Compra\+Controller.\+cs}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00122\ \ \ \ \ \{}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{string}\ nifString\ =\ cliente.Nif.ToString();}
\DoxyCodeLine{00124\ }
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (nifString.Length\ ==\ 9)}
\DoxyCodeLine{00126\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00127\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Se\ o\ NIF\ começar\ com\ '1',\ '2'\ ou\ '3',\ é\ cliente\ particular}}
\DoxyCodeLine{00128\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Caso\ contrário,\ é\ empresa}}
\DoxyCodeLine{00129\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (nifString.StartsWith(\textcolor{stringliteral}{"{}1"{}})\ ||\ nifString.StartsWith(\textcolor{stringliteral}{"{}2"{}})\ ||\ nifString.StartsWith(\textcolor{stringliteral}{"{}3"{}}))}
\DoxyCodeLine{00130\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00131\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 36;\ \textcolor{comment}{//\ Garantia\ de\ 36\ meses\ para\ cliente\ particular}}
\DoxyCodeLine{00132\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00133\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00134\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00135\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 12;\ \textcolor{comment}{//\ Garantia\ de\ 12\ meses\ para\ empresas}}
\DoxyCodeLine{00136\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00137\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00138\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00139\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00140\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 36;\ \textcolor{comment}{//\ Valor\ predefinido\ de\ garantia\ caso\ o\ NIF\ não\ tenha\ 9\ caracteres}}
\DoxyCodeLine{00141\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00142\ \ \ \ \ \}}

\end{DoxyCode}
\label{class_venda_compra_controller_a812cf00477a1fad3bf6bf8d84ac8fb63} 
\index{VendaCompraController@{VendaCompraController}!GetItems@{GetItems}}
\index{GetItems@{GetItems}!VendaCompraController@{VendaCompraController}}
\doxysubsubsection{GetItems()}
{\footnotesize\ttfamily \textbf{ override} \textbf{ List}$<$ \textbf{ object} $>$ Venda\+Compra\+Controller.\+Get\+Items (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [virtual]}}



Obtém os itens de vendas e compras para exibição. 

Este método recupera todas as vendas do repositório, traduz os dados das vendas para um formato de exibição e retorna a lista de itens formatados.

\begin{DoxyReturn}{Retorna}
Uma lista de {\ttfamily Venda\+Compra\+View\+Model}, que contém as informações das vendas para exibição. 
\end{DoxyReturn}


Reimplementado de \textbf{ Base\+Controller$<$ Venda\+Compra $>$} \doxyref{}{p. }{class_base_controller_ab123bcc53c016d37e86c07a4d7cbe3a4}.



Definido na linha \textbf{ 35} do ficheiro \textbf{ Venda\+Compra\+Controller.\+cs}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00036\ \ \ \ \ \{}
\DoxyCodeLine{00037\ \ \ \ \ \ \ \ \ List<VendaCompra>\ vendas\ =\ \_repository.GetAll();}
\DoxyCodeLine{00038\ }
\DoxyCodeLine{00039\ \ \ \ \ \ \ \ \ \_vendasComprasViewItems\ =\ \textcolor{keyword}{new}\ List<VendaCompraViewModel>();}
\DoxyCodeLine{00040\ }
\DoxyCodeLine{00041\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{foreach}\ (var\ venda\ \textcolor{keywordflow}{in}\ vendas)}
\DoxyCodeLine{00042\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00043\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Busca\ cliente\ por\ ID}}
\DoxyCodeLine{00044\ \ \ \ \ \ \ \ \ \ \ \ \ Utilizador?\ cliente\ =\ (Utilizador?)\textcolor{keyword}{new}\ UtilizadorController().GetById(venda.ClienteID);}
\DoxyCodeLine{00045\ }
\DoxyCodeLine{00046\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Criação\ de\ um\ ViewModel\ para\ exibição}}
\DoxyCodeLine{00047\ \ \ \ \ \ \ \ \ \ \ \ \ var\ vendaCompraViewModel\ =\ \textcolor{keyword}{new}\ VendaCompraViewModel}
\DoxyCodeLine{00048\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Id\ =\ venda.Id,}
\DoxyCodeLine{00050\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ClienteNome\ =\ cliente?.Nome,}
\DoxyCodeLine{00051\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ClienteID\ =\ cliente?.Id,}
\DoxyCodeLine{00052\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ NIF\ =\ venda.NIF,}
\DoxyCodeLine{00053\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ DataVenda\ =\ venda.DataVenda,}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ TotalLiquido\ =\ venda.TotalLiquido,}
\DoxyCodeLine{00055\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ MetodoPagamento\ =\ venda.MetodoPagamento.ToString()}
\DoxyCodeLine{00056\ \ \ \ \ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{00057\ }
\DoxyCodeLine{00058\ \ \ \ \ \ \ \ \ \ \ \ \ \_vendasComprasViewItems.Add(vendaCompraViewModel);}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00060\ }
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \_vendasComprasViewItems.Cast<\textcolor{keywordtype}{object}>().ToList();}
\DoxyCodeLine{00062\ \ \ \ \ \}}

\end{DoxyCode}
\label{class_venda_compra_controller_adaf95e7c5855fc3d27b14ac29d01ea55} 
\index{VendaCompraController@{VendaCompraController}!RemoveItem@{RemoveItem}}
\index{RemoveItem@{RemoveItem}!VendaCompraController@{VendaCompraController}}
\doxysubsubsection{RemoveItem()}
{\footnotesize\ttfamily \textbf{ override} \textbf{ void} Venda\+Compra\+Controller.\+Remove\+Item (\begin{DoxyParamCaption}\item[{\textbf{ object}}]{item }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [virtual]}}



Remove uma venda do sistema. 

Este método remove uma venda do sistema após atualizar o stock dos produtos vendidos, considerando a validade da garantia do produto.


\begin{DoxyParams}{Parâmetros}
{\em item} & O item de venda a ser removido. \\
\hline
\end{DoxyParams}

\begin{DoxyExceptions}{Excepções}
{\em Invalid\+Operation\+Exception} & Se a data de fim de garantia for inválida. \\
\hline
\end{DoxyExceptions}


Reimplementado de \textbf{ Base\+Controller$<$ Venda\+Compra $>$} \doxyref{}{p. }{class_base_controller_a8484ff644f75ab6d44e5e902b19e896e}.



Definido na linha \textbf{ 72} do ficheiro \textbf{ Venda\+Compra\+Controller.\+cs}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00073\ \ \ \ \ \{}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ ProdutoController\ produtoController;}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ produtoController\ =\ \textcolor{keyword}{new}\ ProdutoController();}
\DoxyCodeLine{00076\ }
\DoxyCodeLine{00077\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (item\ is\ VendaCompra\ specificItem)}
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00079\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Verifica\ se\ a\ venda\ está\ dentro\ do\ período\ de\ garantia}}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (DateTime.TryParse(specificItem.FimDataGarantia,\ out\ DateTime\ dataFimGarantia))}
\DoxyCodeLine{00081\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00082\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (DateTime.Now\ <=\ dataFimGarantia)}
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Itera\ pelos\ itens\ da\ venda}}
\DoxyCodeLine{00085\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{foreach}\ (ItemVenda\ itemVenda\ \textcolor{keywordflow}{in}\ specificItem.Itens)}
\DoxyCodeLine{00086\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00087\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Busca\ o\ produto\ correspondente\ no\ repositório}}
\DoxyCodeLine{00088\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Produto\ produto\ =\ (Produto)produtoController.GetById(itemVenda.ProdutoID);}
\DoxyCodeLine{00089\ }
\DoxyCodeLine{00090\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (produto\ !=\ \textcolor{keyword}{null})}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Atualiza\ o\ stock\ do\ produto,\ devolvendo\ as\ unidades\ compradas}}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ produto.QuantidadeEmStock\ +=\ itemVenda.Unidades;}
\DoxyCodeLine{00094\ }
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Guarda\ as\ alterações\ no\ repositório\ de\ produtos}}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ produtoController.UpdateItem(produto);}
\DoxyCodeLine{00097\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00099\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00100\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00101\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00102\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00103\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ \textcolor{keyword}{new}\ InvalidOperationException(\textcolor{stringliteral}{"{}A\ data\ de\ fim\ da\ garantia\ é\ inválida."{}});}
\DoxyCodeLine{00104\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00105\ }
\DoxyCodeLine{00106\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Remove\ a\ venda\ após\ atualizar\ o\ stock}}
\DoxyCodeLine{00107\ \ \ \ \ \ \ \ \ \ \ \ \ \_repository.Remove(specificItem);}
\DoxyCodeLine{00108\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00109\ }
\DoxyCodeLine{00110\ }
\DoxyCodeLine{00111\ \ \ \ \ \}}

\end{DoxyCode}


A documentação para esta classe foi gerada a partir do seguinte ficheiro\+:\begin{DoxyCompactItemize}
\item 
POO\+\_\+\+TP\+\_\+29559/\+Controllers/\textbf{ Venda\+Compra\+Controller.\+cs}\end{DoxyCompactItemize}
